<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Second Chance at a Billion</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  <!-- ============================================================ -->
  <!-- MENU SCREEN                                                    -->
  <!-- ============================================================ -->
  <div id="menu-screen">
    <div class="menu-container">
      <h1 class="menu-title">Second Chance at a Billion</h1>
      <p class="menu-subtitle">Travel back in time. Trade with foresight. Try not to get arrested.</p>

      <div class="menu-stats">
        <div class="stat-card">
          <h3>Prestige Points</h3>
          <div class="stat-value" id="menu-pp">0</div>
        </div>
        <div class="stat-card">
          <h3>Runs Completed</h3>
          <div class="stat-value" id="menu-run-count">0</div>
        </div>
      </div>

      <!-- Navigation Buttons -->
      <div class="menu-nav-buttons">
        <button class="btn btn-accent" id="open-shop-btn">Shop</button>
      </div>

      <!-- Trading Modes -->
      <div class="menu-section">
        <h2>Select Mode</h2>
        <div id="mode-selector" class="mode-grid"></div>
      </div>

      <!-- Titles -->
      <div class="menu-section">
        <h2>Titles</h2>
        <div id="title-selector"></div>
      </div>

      <!-- Achievements -->
      <div class="menu-section">
        <h2>Achievements</h2>
        <div id="menu-achievements"></div>
      </div>

      <!-- Leaderboards -->
      <div class="menu-section">
        <h2>Leaderboards</h2>
        <div id="menu-leaderboards"></div>
      </div>

      <!-- Reset -->
      <div class="menu-section" style="text-align: center; padding: 20px 0;">
        <button class="btn btn-danger" onclick="if(confirm('Reset ALL progress?')) { game.progression.resetProgress(); game.showMenu(); }">
          Reset Progress
        </button>
      </div>
    </div>
  </div>

  <!-- ============================================================ -->
  <!-- SHOP SCREEN                                                    -->
  <!-- ============================================================ -->
  <div id="shop-screen" class="hidden">
    <div class="shop-container">
      <div class="shop-header">
        <button class="btn btn-small" id="back-to-menu-btn">‚Üê Back to Menu</button>
        <h1>Progression Shop</h1>
        <div class="shop-pp-display">
          <span class="pp-label">Prestige Points:</span>
          <span class="pp-value" id="shop-pp">0</span>
        </div>
      </div>

      <div class="shop-content">
        <!-- Tree visualization -->
        <div class="shop-tree-area">
          <h2>Unlock Tree</h2>
          <div id="progression-tree" class="progression-tree"></div>
        </div>

        <!-- Detail sidebar -->
        <div class="shop-detail-sidebar">
          <h2>Selected Item</h2>
          <div id="shop-item-detail" class="shop-item-detail">
            <p class="detail-placeholder">Select an item to view details</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ============================================================ -->
  <!-- YEAR SELECTION SCREEN                                          -->
  <!-- ============================================================ -->
  <div id="year-select-screen" class="hidden">
    <div class="year-select-container">
      <button class="btn btn-small" id="year-select-back-btn">‚Üê Back to Menu</button>
      <h1 class="year-select-title">Select Starting Year</h1>
      <p class="section-subtitle" id="year-section-subtitle">Choose when to start your run (2000-2023)</p>
      <div class="year-selection-container">
        <div class="year-range-display">
          <div class="year-display-box">
            <label>Start Year</label>
            <div class="year-value" id="start-year-display">2008</div>
          </div>
          <div class="year-arrow">‚Üí</div>
          <div class="year-display-box">
            <label>End Year</label>
            <div class="year-value" id="end-year-display">2009</div>
          </div>
        </div>
        <div class="year-slider-container">
          <input type="range" id="start-year-slider" min="2000" max="2023" value="2008" class="year-slider">
        </div>
        <div class="year-presets">
          <button class="btn btn-small year-preset-btn" data-start="2007">2008 Crisis</button>
          <button class="btn btn-small year-preset-btn" data-start="2020">2020 Pandemic</button>
          <button class="btn btn-small year-preset-btn" data-start="2000">Dot-com Bubble</button>
          <button class="btn btn-small year-preset-btn" data-start="2017">Crypto Boom</button>
          <button class="btn btn-small year-preset-btn" data-start="2022">Recent Market</button>
        </div>
      </div>
      <button class="btn btn-primary btn-large" id="year-select-start-btn">Start Run</button>
    </div>
  </div>

  <!-- ============================================================ -->
  <!-- GAME SCREEN                                                    -->
  <!-- ============================================================ -->
  <div id="game-screen" class="hidden">

    <!-- Header -->
    <div class="game-header">
      <div class="header-left">
        <span class="day-counter" id="day-counter">Day 0 / 365</span>
        <span class="countdown-timer" id="countdown-timer">T-365 days</span>
        <button class="btn btn-small" id="pause-btn-alt" style="margin-left: 10px; margin-right: 10px;">Pause</button>
        <div class="speed-controls">
          <button class="speed-btn" data-speed="0.5">0.5x</button>
          <button class="speed-btn active" data-speed="1">1x</button>
          <button class="speed-btn" data-speed="2">2x</button>
          <button class="speed-btn" data-speed="5">5x</button>
          <button class="speed-btn" data-speed="10">10x</button>
          <button class="speed-btn" data-speed="20">20x</button>
          <button class="speed-btn" data-speed="50">50x</button>
        </div>
      </div>
      <div class="audio-controls">
        <button id="mute-btn" class="icon-btn" title="Mute">üîä</button>
        <input type="range" id="volume-slider" min="0" max="100" value="70" class="volume-slider">
        <button class="btn btn-small" id="pause-btn">Pause</button>
        <button class="btn btn-small btn-danger" id="exit-btn">Exit</button>
      </div>
    </div>

    <!-- Assets Panel (left) -->
    <div class="assets-panel">
      <!-- Asset Selector -->
      <div class="panel-section">
        <div class="section-title">Assets</div>
        <div class="asset-filter-controls">
          <select id="category-filter" class="category-dropdown">
            <option value="all">All Categories</option>
            <!-- Options populated dynamically -->
          </select>
          <input type="text"
                 id="asset-search"
                 class="asset-search-input"
                 placeholder="Search ticker or name...">
        </div>
        <div id="asset-selector" class="asset-list"></div>
      </div>
    </div>

    <!-- Trade Panel (center-left) -->
    <div class="trade-panel">
      <div class="panel-section">
        <div class="section-title">Trade</div>
        <div class="trade-controls">
          <div class="quantity-input-group">
            <label>Amount</label>
            <div class="quantity-input-wrapper">
              <input type="number" id="trade-quantity" value="1000" min="1" step="100" placeholder="$ Amount">
              <button class="btn btn-small btn-max" id="max-qty-btn">Max</button>
            </div>
            <div class="quick-buy-buttons">
              <button class="btn btn-tiny" data-percent="10">10%</button>
              <button class="btn btn-tiny" data-percent="20">20%</button>
              <button class="btn btn-tiny" data-percent="50">50%</button>
              <button class="btn btn-tiny" data-percent="80">80%</button>
              <button class="btn btn-tiny" data-percent="100">100%</button>
            </div>
            <div id="shares-preview" class="shares-preview">~0 shares</div>
          </div>
          <div class="trade-button-column">
            <button class="btn btn-primary" id="buy-btn">Buy</button>
            <button class="btn btn-accent" id="sell-btn">Sell</button>
            <button class="btn btn-danger" id="short-btn">Short</button>
          </div>
          <div id="trade-result"></div>
        </div>
      </div>

      <!-- Actions -->
      <div class="actions-bar" id="actions-panel"></div>
    </div>

    <!-- Positions Panel (center-center) -->
    <div class="positions-panel">
      <div class="panel-section" style="flex: 1; overflow-y: auto;">
        <div class="section-title">Positions</div>
        <div id="portfolio-list" class="positions-list"></div>
      </div>
    </div>

    <!-- Center: Chart Area -->
    <div class="center-panel">
      <div class="chart-tabs-bar" id="chart-tabs-bar">
        <div class="tabs-scroll-container" id="tabs-scroll"></div>
        <div class="chart-timeframe-buttons">
          <button class="timeframe-btn" data-range="7">1W</button>
          <button class="timeframe-btn" data-range="30">1M</button>
          <button class="timeframe-btn" data-range="252">1Y</button>
          <button class="timeframe-btn active" data-range="max">Max</button>
        </div>
        <button class="tab-add-btn" id="add-chart-btn" title="Add chart">+</button>
      </div>
      <div class="chart-container" id="chart-container"></div>
      <!-- Quarterly Target Panel -->
      <div class="quarterly-target-panel" id="quarterly-panel">
        <div class="quarterly-header">
          <div class="quarterly-level-badges" id="quarterly-badges"></div>
          <div class="quarterly-label" id="quarterly-label">Q1 Y1</div>
        </div>
        <div class="quarterly-target-info">
          <div class="quarterly-target-amount">
            <span class="quarterly-target-label">TARGET</span>
            <span class="quarterly-target-value" id="quarterly-target-value">$2,000</span>
          </div>
          <div class="quarterly-earnings-amount">
            <span class="quarterly-earnings-label">NET WORTH</span>
            <span class="quarterly-earnings-value" id="quarterly-earnings-value">$0</span>
          </div>
        </div>
        <div class="quarterly-progress-bar">
          <div class="quarterly-progress-fill" id="quarterly-progress-fill" style="width: 0%"></div>
        </div>
        <div class="quarterly-timer">
          <span class="quarterly-timer-label">Days remaining:</span>
          <span class="quarterly-timer-value" id="quarterly-timer-value">91</span>
        </div>
      </div>
    </div>

    <!-- Right: Stats & News -->
    <div class="right-panel">
      <!-- Net Worth -->
      <div class="stat-card">
        <h3>Net Worth</h3>
        <div class="chart-timeframe-buttons">
          <button class="nw-timeframe-btn" data-range="7">1W</button>
          <button class="nw-timeframe-btn" data-range="30">1M</button>
          <button class="nw-timeframe-btn" data-range="252">1Y</button>
          <button class="nw-timeframe-btn active" data-range="max">Max</button>
        </div>
        <div class="stat-value" id="net-worth-display">$10,000</div>
        <div class="stat-subvalue">
          Cash: <span id="cash-display">$10,000</span>
        </div>
        <canvas id="net-worth-graph"></canvas>
      </div>

      <!-- Meters -->
      <div class="meters-row">
        <div class="meter">
          <div class="meter-label">
            <span class="meter-name">Internal Risk</span>
            <span class="meter-value" id="risk-value">0%</span>
          </div>
          <div class="meter-bar">
            <div class="meter-fill risk" id="risk-fill" style="width: 0%"></div>
          </div>
        </div>
        <div class="meter">
          <div class="meter-label">
            <span class="meter-name">SEC Attention</span>
            <span class="meter-value" id="sec-value">0%</span>
          </div>
          <div class="meter-bar">
            <div class="meter-fill sec" id="sec-fill" style="width: 0%"></div>
          </div>
          <div class="meter-subtext">
            <span class="sec-label" id="sec-label">Off the radar</span>
          </div>
        </div>
      </div>

      <!-- News Feed -->
      <div class="news-feed-container">
        <h3>Market News</h3>
        <div id="news-feed" class="news-feed"></div>
      </div>
    </div>

    <!-- Bottom Bar -->
    <div class="bottom-bar">
      <div class="bottom-stat">
        <div class="bottom-stat-item">
          <span class="bottom-stat-label">Mode:</span>
          <span class="bottom-stat-value" id="mode-display">Stocks</span>
        </div>
      </div>
      <div class="bottom-stat">
        <div class="bottom-stat-item">
          <span class="bottom-stat-label">Tool:</span>
          <span class="bottom-stat-value" id="tool-display">None</span>
        </div>
      </div>
      <div class="bottom-stat">
        <div class="bottom-stat-item">
          <span class="bottom-stat-label">P&L:</span>
          <span class="bottom-stat-value" id="pnl-display">$0</span>
        </div>
      </div>
    </div>

    <!-- Pause Overlay -->
    <div id="pause-overlay" class="pause-overlay hidden">
      <div class="pause-content">
        <h2>‚è∏ PAUSED</h2>
        <button class="btn btn-primary" id="unpause-btn">Resume</button>
      </div>
    </div>

    <!-- Insider Trading Modal -->
    <div id="insider-modal" class="insider-modal hidden">
      <div class="insider-content">
        <h2>ü§´ Insider Tip Available</h2>
        <p class="insider-tip-text" id="insider-tip-text"></p>
        <p class="insider-warning">Warning: +12 SEC Attention</p>
        <div class="insider-buttons">
          <button class="btn btn-danger" id="insider-accept">Accept Tip</button>
          <button class="btn" id="insider-ignore">Ignore</button>
        </div>
      </div>
    </div>

    <!-- Tutorial Popup -->
    <div id="tutorial-modal" class="tutorial-modal hidden">
      <div class="tutorial-content">
        <h2>How to Play</h2>
        <div class="tutorial-body">
          <p><strong>You're a time traveler with knowledge of the future.</strong> Use it to trade stocks and build your fortune - but don't attract too much attention from the SEC.</p>
          <div class="tutorial-tips">
            <div class="tutorial-tip">
              <span class="tutorial-tip-icon">üìà</span>
              <span><strong>Buy & Sell:</strong> Select a stock from the left panel, enter a dollar amount, and click Buy. Close positions from the Positions panel.</span>
            </div>
            <div class="tutorial-tip">
              <span class="tutorial-tip-icon">üéØ</span>
              <span><strong>Quarterly Targets:</strong> Hit net worth milestones each quarter or get fired. Early completion gives bonus time for the next target.</span>
            </div>
            <div class="tutorial-tip">
              <span class="tutorial-tip-icon">üîç</span>
              <span><strong>SEC Attention:</strong> Trading too well raises suspicion. If SEC Attention hits 100%, you get arrested and the run ends.</span>
            </div>
            <div class="tutorial-tip">
              <span class="tutorial-tip-icon">‚è±Ô∏è</span>
              <span><strong>Speed Controls:</strong> Use speed buttons (0.5x - 50x) or press Space to pause. Each tick = 1 trading day.</span>
            </div>
            <div class="tutorial-tip">
              <span class="tutorial-tip-icon">üèÜ</span>
              <span><strong>Prestige Points:</strong> Earned by hitting quarterly targets. Spend them in the Shop to unlock upgrades for future runs.</span>
            </div>
          </div>
        </div>
        <div class="tutorial-footer">
          <label class="tutorial-checkbox-label">
            <input type="checkbox" id="tutorial-dont-show">
            Don't show this again
          </label>
          <button class="btn btn-primary" id="tutorial-start-btn">Start Trading</button>
        </div>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
      <div class="loading-spinner"></div>
      <div class="loading-text">Loading market data...</div>
    </div>

    <!-- Achievement Popup -->
    <div id="achievement-popup" class="hidden"></div>
  </div>

  <!-- ============================================================ -->
  <!-- RUN END SCREEN                                                 -->
  <!-- ============================================================ -->
  <div id="run-end-screen" class="hidden">
    <div class="run-end-container">
      <h1 id="run-end-title" class="run-end-title">RUN OVER</h1>

      <div id="run-end-stats" class="run-end-stats"></div>

      <h3 style="margin-top: 20px;">NEW ACHIEVEMENTS</h3>
      <div id="run-end-achievements"></div>

      <button class="btn btn-primary mt-2" id="back-to-menu">BACK TO MENU</button>
    </div>
  </div>

  <!-- ============================================================ -->
  <!-- SCRIPTS (order matters)                                        -->
  <!-- ============================================================ -->
  <script src="js/sp500_tickers.js"></script>
  <script src="js/config.js"></script>
  <script src="js/data_loader.js"></script>
  <script src="js/market.js"></script>
  <script src="js/trading.js"></script>
  <script src="js/sec.js"></script>
  <script src="js/news.js"></script>
  <script src="js/quarterly.js"></script>
  <script src="js/progression.js"></script>
  <script src="js/achievements.js"></script>
  <script src="js/leaderboard.js"></script>
  <script src="js/chart_manager.js"></script>
  <script src="js/audio_engine.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/main.js"></script>

</body>
</html>
